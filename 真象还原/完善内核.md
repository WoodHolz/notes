# 完善内核

## 函数调用规定

使用栈来保持参数

在汇编语言中存在调用存入参数的顺序问题，需要对此做出约定

stdcall 约定 

``` mermaid
graph TB
    a["调用者将参数从右到左压栈"]
    b["被调用者清理参数所占的栈空间"]
    c["具体是用`ret 立即数`顺便完成"]
    a --> b
    b -.- c
```

> 这里的清理并不需要将栈中内容置 0，将栈顶指针恢复即可

cdecl 约定

``` mermaid
graph TB
    a["调用者将参数从右到左压栈"]
    b["调用者清理参数所占的栈空间"]
    a --> b
```

## 混合编程

（1）单独的汇编代码文件与单独的 C 语言文件分别编译成目标文件后，一起链接成可执行程序。
（2）在 C 语言中嵌入汇编代码，直接编译生成可执行程序。

调用“系统调用”有两种方式。
（1）将系统调用指令封装为 c 库函数，通过库函数进行系统调用，操作简单。
（2）不依赖任何库函数，直接通过汇编指令 int 与操作系统通信。

当输入的参数小于等于 5 个时，Linux 用寄存器传递参数。当参数个数大于 5 个时，把参数按照顺序放入连续的内存区域，并将该区域的首地址放到 ebx 寄存器。
（1）ebx 存储第 1 个参数。
（2）ecx 存储第 2 个参数。
（3）edx 存储第 3 个参数。
（4）esi 存储第 4 个参数。
（5）edi 存储第 5 个参数。